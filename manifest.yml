modules:
  jira:adminPage:
    - key: sync-connector-admin
      resource: admin-ui
      resolver:
        function: resolver
      title: Sync Connector Configuration

  trigger:
    - key: issue-created
      function: sync-trigger
      events:
        - avi:jira:created:issue

    - key: issue-updated
      function: sync-trigger
      events:
        - avi:jira:updated:issue

    - key: issue-commented
      function: comment-trigger
      events:
        - avi:jira:commented:issue

    - key: issue-link-created
      function: link-trigger
      events:
        - avi:jira-issue-link:created

    - key: issue-link-deleted
      function: link-deleted-trigger
      events:
        - avi:jira-issue-link:deleted

    - key: issue-deleted
      function: issue-deleted-trigger
      events:
        - avi:jira:deleted:issue

  scheduledTrigger:
    - key: scheduled-sync
      interval: hour
      function: scheduled-sync-function

  consumer:
    - key: bulk-sync-consumer
      queue: bulk-sync-queue
      function: bulk-sync-function

    - key: manual-sync-consumer
      queue: manual-sync-queue
      function: manual-sync-func

  webtrigger:
    - key: incoming-webhook
      function: incoming-webhook-func

  function:
    - key: sync-trigger
      handler: index.run

    - key: comment-trigger
      handler: index.runComment

    - key: link-trigger
      handler: index.runLinkCreated

    - key: link-deleted-trigger
      handler: index.runLinkDeleted

    - key: issue-deleted-trigger
      handler: index.runIssueDeleted

    - key: scheduled-sync-function
      handler: index.runScheduledSync
      timeoutSeconds: 900

    - key: bulk-sync-function
      handler: index.runBulkSync
      timeoutSeconds: 900

    - key: manual-sync-func
      handler: index.runManualScheduledSync
      timeoutSeconds: 900

    - key: incoming-webhook-func
      handler: index.runIncomingWebhook

    - key: resolver
      handler: index.handler

resources:
  - key: admin-ui
    path: static/admin-page/build

app:
  id: ari:cloud:ecosystem::app/362d8e6b-b68c-4403-8020-d32ddcc02716
  runtime:
    name: nodejs20.x

permissions:
  scopes:
    - storage:app
    - read:jira-work
    - write:jira-work
    - read:jira-user
    - read:comment:jira
    - write:comment:jira
    - read:issue-link:jira
    - write:issue-link:jira
    - read:issue-meta:jira
    - read:project:jira
  external:
    fetch:
      backend:
        - address: "*.atlassian.net"
  content:
    styles: []
